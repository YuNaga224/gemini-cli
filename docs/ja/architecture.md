# Gemini CLI アーキテクチャ概要

このドキュメントは、Gemini CLI のアーキテクチャの高レベル概要を提供します。

## コアコンポーネント

Gemini CLI は主に2つのメインパッケージで構成されており、コマンドライン入力の処理過程でシステムが使用できるツール群も含まれています：

1.  **CLI パッケージ (`packages/cli`):**
    - **目的:** Gemini CLI のユーザー向け部分を含み、初期のユーザー入力の処理、最終出力の表示、全体的なユーザーエクスペリエンスの管理を行います。
    - **パッケージに含まれる主要機能:**
      - [入力処理](./cli/commands.md)
      - 履歴管理
      - 表示レンダリング
      - [テーマとUI カスタマイズ](./cli/themes.md)
      - [CLI 設定](./cli/configuration.md)

2.  **Core パッケージ (`packages/core`):**
    - **目的:** Gemini CLI のバックエンドとして機能します。`packages/cli` から送信されたリクエストを受信し、Gemini API との相互作用を調整し、利用可能なツールの実行を管理します。
    - **パッケージに含まれる主要機能:**
      - Google Gemini API との通信用APIクライアント
      - プロンプトの構築と管理
      - ツールの登録と実行ロジック
      - 会話やセッションの状態管理
      - サーバーサイド設定

3.  **ツール (`packages/core/src/tools/`):**
    - **目的:** Gemini モデルの機能を拡張する個別のモジュールで、ローカル環境（ファイルシステム、シェルコマンド、Webフェッチなど）との相互作用を可能にします。
    - **相互作用:** `packages/core` は Gemini モデルからのリクエストに基づいてこれらのツールを呼び出します。

## 相互作用フロー

Gemini CLI との典型的な相互作用は以下のフローに従います：

1.  **ユーザー入力:** ユーザーがターミナルにプロンプトやコマンドを入力し、これは `packages/cli` によって管理されます。
2.  **コアへのリクエスト:** `packages/cli` がユーザーの入力を `packages/core` に送信します。
3.  **リクエスト処理:** コアパッケージが以下を実行します：
    - 会話履歴や利用可能なツール定義を含む適切なプロンプトを Gemini API 用に構築
    - プロンプトを Gemini API に送信
4.  **Gemini API の応答:** Gemini API がプロンプトを処理し、応答を返します。この応答は直接的な回答であったり、利用可能なツールの使用要求であったりします。
5.  **ツール実行（該当する場合）:**
    - Gemini API がツールを要求した場合、コアパッケージが実行準備を行います
    - 要求されたツールがファイルシステムを変更したりシェルコマンドを実行できる場合、ユーザーにはまずツールとその引数の詳細が提示され、ユーザーが実行を承認する必要があります
    - ファイル読み取りなどの読み取り専用操作では、明示的なユーザー確認は不要の場合があります
    - 確認が得られるか、確認が不要な場合、コアパッケージが関連するツール内で関連アクションを実行し、結果がコアパッケージによって Gemini API に送り返されます
    - Gemini API がツール結果を処理し、最終応答を生成します
6.  **CLI への応答:** コアパッケージが最終応答を CLI パッケージに送り返します。
7.  **ユーザーへの表示:** CLI パッケージが応答をフォーマットし、ターミナルでユーザーに表示します。

## 主要設計原則

- **モジュラリティ:** CLI（フロントエンド）と Core（バックエンド）を分離することで、独立した開発と将来の拡張の可能性（例：同じバックエンドに対する異なるフロントエンド）を可能にします。
- **拡張性:** ツールシステムは拡張可能に設計されており、新しい機能を追加できます。
- **ユーザーエクスペリエンス:** CLI は豊富で対話的なターミナル体験の提供に焦点を当てています。